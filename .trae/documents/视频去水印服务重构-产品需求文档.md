# 视频去水印服务重构 - 产品需求文档

## 1. Product Overview

本项目是将现有Python视频去水印服务重构为TypeScript版本，专注于抖音和小红书平台的内容解析功能。
- 主要目的：提供高效的视频/图片链接解析服务，去除水印并提取原始媒体资源
- 目标用户：需要批量处理社交媒体内容的开发者和内容创作者
- 市场价值：为内容聚合和分析平台提供核心的媒体资源提取能力

## 2. Core Features

### 2.1 User Roles

本服务为API服务，无需用户角色区分，所有接口均为公开访问。

### 2.2 Feature Module

我们的视频去水印服务包含以下核心页面：
1. **通用解析接口**：自动识别平台类型，统一处理解析请求
2. **抖音专用接口**：专门处理抖音平台的视频和图片内容
3. **小红书专用接口**：专门处理小红书平台的笔记内容
4. **健康检查接口**：服务状态监控和可用性检查

### 2.3 Page Details

| Page Name | Module Name | Feature description |
|-----------|-------------|---------------------|
| 通用解析接口 | URL识别模块 | 从输入文本中提取URL，自动识别平台类型（抖音/小红书），路由到对应处理器 |
| 通用解析接口 | 响应格式化 | 统一返回JSON格式，包含状态码、数据和消息字段 |
| 抖音专用接口 | 内容解析 | 解析抖音分享链接，提取视频URL、图片列表、标题和描述信息 |
| 抖音专用接口 | 去水印处理 | 将带水印的播放链接转换为无水印版本 |
| 小红书专用接口 | 笔记解析 | 解析小红书笔记链接，提取图片、视频、标题和描述 |
| 小红书专用接口 | 图片格式转换 | 支持PNG和WebP格式的图片输出，提供不同质量选项 |
| 健康检查接口 | 状态监控 | 返回服务运行状态和环境信息 |

## 3. Core Process

**主要用户操作流程：**

1. 用户发送POST请求到解析接口，携带包含分享链接的文本
2. 系统从文本中提取URL并识别平台类型
3. 根据平台类型调用对应的解析器
4. 解析器获取页面内容并提取媒体资源信息
5. 系统返回格式化的JSON响应，包含去水印后的资源链接

```mermaid
graph TD
  A[客户端请求] --> B[/analyze 通用接口]
  A --> C[/analyze/douyin 抖音接口]
  A --> D[/analyze/xiaohongshu 小红书接口]
  B --> E[URL提取和平台识别]
  E --> F[抖音解析器]
  E --> G[小红书解析器]
  C --> F
  D --> G
  F --> H[返回JSON响应]
  G --> H
```

## 4. User Interface Design

### 4.1 Design Style

本项目为纯API服务，无前端界面。API设计遵循RESTful规范：
- 响应格式：统一JSON格式
- 状态码：200表示成功，500表示错误
- 错误处理：详细的错误信息和堆栈跟踪
- 日志记录：结构化日志，支持不同级别

### 4.2 API Response Format

| Response Field | Data Type | Description |
|----------------|-----------|-------------|
| code | number | 状态码，200成功，500错误 |
| data | object/null | 解析结果数据，错误时为null |
| message | string | 响应消息，成功或错误描述 |

### 4.3 Responsiveness

- 服务支持跨平台部署（Linux、macOS、Windows）
- 支持容器化部署
- 提供健康检查端点用于负载均衡器监控
- 支持水平扩展